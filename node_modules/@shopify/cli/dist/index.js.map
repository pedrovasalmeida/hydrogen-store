{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["// CLI\nimport {version as cliVersion} from '../package.json'\nimport {run, settings, flush} from '@oclif/core'\nimport Bugsnag from '@bugsnag/js'\nimport {error as kitError, environment, output} from '@shopify/cli-kit'\n\nfunction runCLI() {\n  output.initiateLogging({filename: 'shopify.cli.log'})\n  if (environment.local.isDebug()) {\n    settings.debug = true\n  } else {\n    Bugsnag.start({\n      apiKey: '9e1e6889176fd0c795d5c659225e0fae',\n      logger: null,\n      appVersion: cliVersion,\n      autoTrackSessions: false,\n    })\n  }\n\n  run(undefined, import.meta.url)\n    .then(flush)\n    .catch((error: Error): Promise<void | Error> => {\n      if (error instanceof kitError.AbortSilent) {\n        process.exit(1)\n      }\n      const kitMapper = kitError.mapper\n      const kitHandle = kitError.handler\n      // eslint-disable-next-line promise/no-nesting\n      return kitMapper(error)\n        .then(bugsnagHandle)\n        .then((error: Error) => {\n          return kitHandle(error)\n        })\n        .then(() => {\n          process.exit(1)\n        })\n    })\n}\n\nconst bugsnagHandle = async (errorToReport: Error): Promise<Error> => {\n  if (!settings.debug && kitError.shouldReport(errorToReport)) {\n    let mappedError: Error\n    // eslint-disable-next-line no-prototype-builtins\n    if (Object.prototype.isPrototypeOf(errorToReport)) {\n      const mappedError = Object.assign(Object.create(errorToReport), {})\n      if (mappedError.stack) mappedError.stack = mappedError.stack.replace(new RegExp('file:///', 'g'), '/')\n    } else {\n      mappedError = errorToReport\n    }\n    await new Promise((resolve, reject) => {\n      Bugsnag.notify(mappedError, undefined, resolve)\n    })\n  }\n  return Promise.resolve(errorToReport)\n}\n\nexport default runCLI\n"],"names":["cliVersion","error","kitError"],"mappings":";;;;;;AAMA,SAAkB,MAAA,GAAA;AAChB,EAAA,MAAA,CAAO,eAAgB,CAAA,EAAC,QAAU,EAAA,iBAAA,EAAkB,CAAA,CAAA;AACpD,EAAI,IAAA,WAAA,CAAY,KAAM,CAAA,OAAA,EAAW,EAAA;AAC/B,IAAA,QAAA,CAAS,KAAQ,GAAA,IAAA,CAAA;AAAA,GACZ,MAAA;AACL,IAAA,OAAA,CAAQ,KAAM,CAAA;AAAA,MACZ,MAAQ,EAAA,kCAAA;AAAA,MACR,MAAQ,EAAA,IAAA;AAAA,MACR,UAAY,EAAAA,OAAA;AAAA,MACZ,iBAAmB,EAAA,KAAA;AAAA,KACpB,CAAA,CAAA;AAAA,GACH;AAEA,EAAI,GAAA,CAAA,KAAA,CAAA,EAAW,YAAY,GAAG,CAAA,CAC3B,KAAK,KAAK,CAAA,CACV,KAAM,CAAA,CAACC,OAAwC,KAAA;AAC9C,IAAI,IAAAA,OAAA,YAAiBC,MAAS,WAAa,EAAA;AACzC,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA,CAAA;AAAA,KAChB;AACA,IAAA,MAAM,YAAYA,KAAS,CAAA,MAAA,CAAA;AAC3B,IAAA,MAAM,YAAYA,KAAS,CAAA,OAAA,CAAA;AAE3B,IAAO,OAAA,SAAA,CAAUD,OAAK,CACnB,CAAA,IAAA,CAAK,aAAa,CAClB,CAAA,IAAA,CAAK,CAAC,MAAiB,KAAA;AACtB,MAAA,OAAO,UAAU,MAAK,CAAA,CAAA;AAAA,KACvB,CACA,CAAA,IAAA,CAAK,MAAM;AACV,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA,CAAA;AAAA,KACf,CAAA,CAAA;AAAA,GACJ,CAAA,CAAA;AACL,CAAA;AAEA,MAAM,aAAA,GAAgB,OAAO,aAAyC,KAAA;AACpE,EAAA,IAAI,CAAC,QAAS,CAAA,KAAA,IAASC,KAAS,CAAA,YAAA,CAAa,aAAa,CAAG,EAAA;AAC3D,IAAI,IAAA,WAAA,CAAA;AAEJ,IAAA,IAAI,MAAO,CAAA,SAAA,CAAU,aAAc,CAAA,aAAa,CAAG,EAAA;AACjD,MAAM,MAAA,YAAA,GAAc,OAAO,MAAO,CAAA,MAAA,CAAO,OAAO,aAAa,CAAA,EAAG,EAAE,CAAA,CAAA;AAClE,MAAA,IAAI,YAAY,CAAA,KAAA;AAAO,QAAY,YAAA,CAAA,KAAA,GAAQ,aAAY,KAAM,CAAA,OAAA,CAAQ,IAAI,MAAO,CAAA,UAAA,EAAY,GAAG,CAAA,EAAG,GAAG,CAAA,CAAA;AAAA,KAChG,MAAA;AACL,MAAc,WAAA,GAAA,aAAA,CAAA;AAAA,KAChB;AACA,IAAA,MAAM,IAAI,OAAA,CAAQ,CAAC,OAAA,EAAS,MAAW,KAAA;AACrC,MAAQ,OAAA,CAAA,MAAA,CAAO,WAAa,EAAA,KAAA,CAAA,EAAW,OAAO,CAAA,CAAA;AAAA,KAC/C,CAAA,CAAA;AAAA,GACH;AACA,EAAO,OAAA,OAAA,CAAQ,QAAQ,aAAa,CAAA,CAAA;AACtC,CAAA;;;;"}